<header
  class="fixed top-0 w-full bg-white/80 dark:bg-[#1A1F2E]/80 backdrop-blur-md border-b border-[#E5E7EB] dark:border-[#2D3748] z-50 transition-colors"
>
  <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
    <a
      href="#hero"
      class="text-xl font-semibold hover:text-[#6366F1] transition-colors"
    >
      Pedro Bustamante
    </a>

    <!-- Desktop Navigation with Theme Toggle -->
    <div class="hidden md:flex items-center gap-6">
      <nav class="flex items-center">
      <ul class="flex gap-8 list-none text-sm font-medium">
        <li>
          <a
            href="#about"
            class="text-[#6B7280] hover:text-[#6366F1] transition-colors nav-link"
            data-i18n="header.about"
            >Sobre mí</a
          >
        </li>
        <li>
          <a
            href="#experience"
            class="text-[#6B7280] hover:text-[#6366F1] transition-colors nav-link"
            data-i18n="header.experience"
            >Experiencia</a
          >
        </li>
        <li>
          <a
            href="#stack"
            class="text-[#6B7280] hover:text-[#6366F1] transition-colors nav-link"
            data-i18n="header.stack">Stack</a
          >
        </li>
        <li>
          <a
            href="#projects"
            class="text-[#6B7280] hover:text-[#6366F1] transition-colors nav-link"
            data-i18n="header.projects"
            >Proyectos</a
          >
        </li>
        <li>
          <a
            href="#education"
            class="text-[#6B7280] hover:text-[#6366F1] transition-colors nav-link"
            data-i18n="header.studies">Formación</a
          >
        </li>
        <li>
          <a
            href="#contact"
            class="text-[#6B7280] hover:text-[#6366F1] transition-colors nav-link"
            data-i18n="header.contact"
            >Contacto</a
          >
        </li>
      </ul>
      </nav>

      <!-- Language Toggle (Desktop) -->
      <button
        id="language-toggle"
        class="w-10 h-10 rounded-xl bg-[#F9FAFB] dark:bg-[#2D3748] border-2 border-[#E5E7EB] dark:border-[#2D3748] flex items-center justify-center hover:border-[#6366F1] dark:hover:border-[#6366F1] transition-all group"
        aria-label="Toggle language"
        title="Change language"
      >
        <span class="text-sm font-bold text-[#6B7280] dark:text-[#9CA3AF] group-hover:text-[#6366F1] transition-colors" id="lang-text">ES</span>
      </button>

      <!-- Dark Mode Toggle (Desktop) -->
      <button
        id="theme-toggle"
        class="w-10 h-10 rounded-xl bg-[#F9FAFB] dark:bg-[#2D3748] border-2 border-[#E5E7EB] dark:border-[#2D3748] flex items-center justify-center hover:border-[#6366F1] dark:hover:border-[#6366F1] transition-all"
        aria-label="Toggle dark mode"
      >
        <!-- Sun Icon (shown in dark mode) -->
        <svg id="sun-icon" class="w-5 h-5 hidden text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
        </svg>
        <!-- Moon Icon (shown in light mode) -->
        <svg id="moon-icon" class="w-5 h-5 text-[#6366F1]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile Menu Toggle -->
    <div class="flex md:hidden items-center gap-2">
      <!-- Language Toggle (Mobile) -->
      <button
        id="language-toggle-mobile"
        class="w-10 h-10 rounded-xl bg-[#F9FAFB] dark:bg-[#2D3748] border-2 border-[#E5E7EB] dark:border-[#2D3748] flex items-center justify-center hover:border-[#6366F1] dark:hover:border-[#6366F1] transition-all group"
        aria-label="Toggle language"
      >
        <span class="text-sm font-bold text-[#6B7280] dark:text-[#9CA3AF] group-hover:text-[#6366F1] transition-colors lang-text-mobile">ES</span>
      </button>

      <!-- Dark Mode Toggle (Mobile) -->
      <button
        id="theme-toggle-mobile"
        class="w-10 h-10 rounded-xl bg-[#F9FAFB] dark:bg-[#2D3748] border-2 border-[#E5E7EB] dark:border-[#2D3748] flex items-center justify-center hover:border-[#6366F1] dark:hover:border-[#6366F1] transition-all"
        aria-label="Toggle dark mode"
      >
        <!-- Sun Icon (shown in dark mode) -->
        <svg class="sun-icon w-5 h-5 hidden text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
        </svg>
        <!-- Moon Icon (shown in light mode) -->
        <svg class="moon-icon w-5 h-5 text-[#6366F1]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
        </svg>
      </button>

      <button
        class="menu-toggle text-2xl hover:text-[#6366F1] transition-colors"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav md:hidden">
      <ul class="flex flex-col gap-0 list-none text-sm font-medium">
        <li>
          <a
            href="#about"
            class="text-[#6B7280] hover:text-[#6366F1] transition-colors nav-link"
            data-i18n="header.about"
            >Sobre mí</a
          >
        </li>
        <li>
          <a
            href="#experience"
            class="text-[#6B7280] hover:text-[#6366F1] transition-colors nav-link"
            data-i18n="header.experience"
            >Experiencia</a
          >
        </li>
        <li>
          <a
            href="#stack"
            class="text-[#6B7280] hover:text-[#6366F1] transition-colors nav-link"
            data-i18n="header.stack">Stack</a
          >
        </li>
        <li>
          <a
            href="#projects"
            class="text-[#6B7280] hover:text-[#6366F1] transition-colors nav-link"
            data-i18n="header.projects"
            >Proyectos</a
          >
        </li>
        <li>
          <a
            href="#studies"
            class="text-[#6B7280] hover:text-[#6366F1] transition-colors nav-link"
            data-i18n="header.studies">Formación</a
          >
        </li>
        <li>
          <a
            href="#contact"
            class="text-[#6B7280] hover:text-[#6366F1] transition-colors nav-link"
            data-i18n="header.contact"
            >Contacto</a
          >
        </li>
      </ul>
    </nav>
  </div>
</header>

<script>
  import { translations } from '../i18n/translations';
  import type { Language } from '../i18n/translations';

  document.addEventListener("DOMContentLoaded", () => {
    const menuToggle = document.querySelector(".menu-toggle");
    const mobileNav = document.querySelector(".mobile-nav");
    const themeToggle = document.getElementById("theme-toggle");
    const themeToggleMobile = document.getElementById("theme-toggle-mobile");
    const languageToggle = document.getElementById("language-toggle");
    const languageToggleMobile = document.getElementById("language-toggle-mobile");

    const sunIcon = document.getElementById("sun-icon");
    const moonIcon = document.getElementById("moon-icon");
    const sunIconsMobile = document.querySelectorAll(".sun-icon");
    const moonIconsMobile = document.querySelectorAll(".moon-icon");
    const langText = document.getElementById("lang-text");
    const langTextMobile = document.querySelector(".lang-text-mobile");

    // Get current language from localStorage
    function getCurrentLanguage(): Language {
      const saved = localStorage.getItem('language');
      return (saved === 'en' || saved === 'es') ? saved : 'es';
    }

    // Update language button text
    function updateLanguageButtons() {
      const lang = getCurrentLanguage();
      if (langText) langText.textContent = lang.toUpperCase();
      if (langTextMobile) langTextMobile.textContent = lang.toUpperCase();
    }

    // Update all translatable elements
    function updateTranslations() {
      const lang = getCurrentLanguage();
      const elements = document.querySelectorAll('[data-i18n]');

      elements.forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (key && key in translations[lang]) {
          element.textContent = translations[lang][key as keyof typeof translations.es];
        }
      });
    }

    // Toggle language
    function toggleLanguage() {
      const current = getCurrentLanguage();
      const newLang = current === 'es' ? 'en' : 'es';
      localStorage.setItem('language', newLang);
      document.documentElement.lang = newLang;
      updateLanguageButtons();
      updateTranslations();

      // Dispatch custom event for other components to listen
      window.dispatchEvent(new CustomEvent('languagechange', { detail: { language: newLang } }));
    }

    // Initialize language
    updateLanguageButtons();
    updateTranslations();

    // Language toggle handlers
    languageToggle?.addEventListener('click', toggleLanguage);
    languageToggleMobile?.addEventListener('click', toggleLanguage);

    // Function to update icons
    function updateIcons() {
      const isDark = document.documentElement.classList.contains("dark");

      // Desktop icons
      if (sunIcon && moonIcon) {
        if (isDark) {
          sunIcon.classList.remove("hidden");
          moonIcon.classList.add("hidden");
        } else {
          sunIcon.classList.add("hidden");
          moonIcon.classList.remove("hidden");
        }
      }

      // Mobile icons
      sunIconsMobile.forEach(icon => {
        if (isDark) {
          icon.classList.remove("hidden");
        } else {
          icon.classList.add("hidden");
        }
      });

      moonIconsMobile.forEach(icon => {
        if (isDark) {
          icon.classList.add("hidden");
        } else {
          icon.classList.remove("hidden");
        }
      });
    }

    // Initialize icons on load
    updateIcons();

    // Mobile menu toggle
    menuToggle?.addEventListener("click", () => {
      mobileNav?.classList.toggle("open-mobile");
    });

    mobileNav?.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", () => {
        if (mobileNav.classList.contains("open-mobile")) {
          mobileNav.classList.remove("open-mobile");
        }
      });
    });

    // Dark mode toggle function
    function toggleTheme() {
      document.documentElement.classList.toggle("dark");
      const isDark = document.documentElement.classList.contains("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
      updateIcons();
    }

    // Desktop dark mode toggle
    themeToggle?.addEventListener("click", toggleTheme);

    // Mobile dark mode toggle
    themeToggleMobile?.addEventListener("click", toggleTheme);
  });
</script>

<style>
  .mobile-nav {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    background-color: white;
    border-bottom: 1px solid #E5E7EB;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  }

  :global(.dark) .mobile-nav {
    background-color: #1A1F2E;
    border-bottom: 1px solid #2D3748;
  }

  .mobile-nav.open-mobile {
    display: block;
  }

  .mobile-nav ul li {
    width: 100%;
    border-top: 1px solid #E5E7EB;
  }

  :global(.dark) .mobile-nav ul li {
    border-top: 1px solid #2D3748;
  }

  .mobile-nav ul li a {
    padding: 1rem 1.5rem;
    display: block;
    font-size: 1rem;
  }

  @media screen and (min-width: 768px) {
    .mobile-nav {
      display: none !important;
    }
  }
</style>
